<app-header-create title="Создание справки аренды"></app-header-create>

<form class="tui-container tui-container_adaptive" [formGroup]="form">
  <div class="tui-row tui-row_adaptive">
    <!-- <tui-input-number formControlName="number" class="tui-col_md-3">
      Номер счета
    </tui-input-number> -->
    <app-status-panel
      class="tui-col_xs-12 tui-col_s-1 tui-col_sm-1 tui-col_md-4"
      type="rentalCertificate"
      (changed)="selectStatus($event)"
    ></app-status-panel>
    <!-- <tui-input-date-range
      class="tui-col_xs-12 tui-col_s-1 tui-col_sm-1 tui-col_md-5 tui-col_lg-5"
      tuiUnfinishedValidator="Finish filling the field"
      formControlName="dateRange"
      [min]="initDate(0)"
      [minLength]="{ day: 3 }"
      [maxLength]="{ month: 1 }"
      tuiHintContent="минимальный диапазон 3 дня, максимальный диапазон: 1 месяц"
    >
      Время действия счёта
    </tui-input-date-range> -->
  </div>

  <div class="tui-row tui-row_adaptive tui-space_top-5">
    <div
      class="tui-col_xs-12 tui-col_s-1 tui-col_sm-1 tui-col_md-9 tui-col_lg-9"
    >
      <h1 class="header" [class.header_empty]="!f.number.value">
        Справка аренды
        <span *ngIf="f.services.value?.length">от {{ getMinDate }}</span>
        <!-- <tui-input-inline
          *ngIf="isEditingNumber; else rentalCertificateNumberText"
          #inputNumber
          tuiAutoFocus
          formControlName="number"
          (focusedChange)="onFocusedChange($event)"
          (keydown.esc.prevent)="toggleRentalCertificateNumber()"
          (keydown.enter.prevent)="toggleRentalCertificateNumber()"
        >
          Type a heading
        </tui-input-inline> -->
        <ng-template #rentalCertificateNumberText>
          <span>{{ f.number.value }}</span>
          <button
            tuiIconButton
            type="button"
            class="tui-space_left-1"
            title="изменить номер"
            size="xs"
            appearance="icon"
            icon="tuiIconEditLarge"
            (click)="toggleRentalCertificateNumber()"
          ></button>
        </ng-template>
      </h1>
      <tui-text-area formControlName="description" [expandable]="true">
        Краткое описание
      </tui-text-area>
    </div>
    <div
      class="tui-col_xs-12 tui-col_s-1 tui-col_sm-1 tui-col_md-3 tui-col_lg-3"
    >
      <!-- <tui-input-file
        class="container"
        link="Выберите файл с логотипом"
        accept="image/*"
        [formControl]="logotype"
        [loadingFiles]="loading$ | async"
        [rejectedFiles]="rejected$ | async"
    ></tui-input-file> -->
      <!-- <h2>QR код</h2> -->
      <qrcode
        #qrBlock
        [qrdata]="f._id.value"
        [width]="125"
        [errorCorrectionLevel]="'H'"
        [elementType]="'img'"
      ></qrcode>
    </div>
  </div>

  <div class="tui-row tui-row_adaptive">
    <div
      class="tui-col_xs-12 tui-col_s-1 tui-col_sm-1 tui-col_md-6 tui-col_lg-6"
    >
      <h5>Арендодатель</h5>
      <app-company-panel
        *ngIf="f.profileCompany.value"
        [data]="f.profileCompany.value"
        [isLoaded]="f.profileCompany.value"
        [canChange]="false"
      ></app-company-panel>
    </div>
    <div
      class="tui-col_xs-12 tui-col_s-1 tui-col_sm-1 tui-col_md-6 tui-col_lg-6"
    >
      <h5>Арендатор</h5>
      <app-contractor-panel
        [contractor]="form.controls.contractor.value"
        (selected)="selectContractor($event)"
      ></app-contractor-panel>
    </div>
  </div>

  <div class="tui-row tui-row_adaptive tui-space_top-8">
    <div
      class="
        tui-col_xs-12 tui-col_s-12 tui-col_sm-12 tui-col_md-12 tui-col_lg-12
      "
    >
      <div class="tui-form__row">
        <div class="tui-form__field">
          <app-service-table
            (selected)="selectService($event)"
          ></app-service-table>
        </div>
      </div>
    </div>
  </div>

  <div class="tui-row tui-row_adaptive tui-space_top-10">
    <div
      class="
        tui-col_xs-12 tui-col_s-12 tui-col_sm-12 tui-col_md-12 tui-col_lg-12
      "
    >
      <button
        tuiButton
        type="button"
        class="tui-space_right-3 tui-space_bottom-3"
        appearance="outline"
        (click)="cancel()"
      >
        Отменить
      </button>
      <button
        tuiButton
        type="button"
        class="tui-space_right-3 tui-space_bottom-3"
        (click)="save()"
        [disabled]="!isRentalCertificateValid"
      >
        Создать
      </button>
    </div>
  </div>
</form>
